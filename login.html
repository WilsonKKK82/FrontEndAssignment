<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login/Signup - Fashion Store</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icon Styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts Style-->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- Login CSS -->
    <link rel="stylesheet" href="login.css">

</head>
<body>
    <!-- Back to main site link -->
    <a href="index.html" class="back-link">
        <i class="fas fa-arrow-left me-2"></i>Back to Shop
    </a>

    <!-- Main Auth Container -->
    <div class="container-fluid auth-container">
        <div class="row justify-content-center w-100">
            <div class="col-12">
                <div class="auth-card mx-auto">
                    <!-- Header -->
                    <div class="auth-header">
                        <h1 class="logo">NIKU</h1>
                        <p class="auth-subtitle mb-0">Welcome to our shoes store</p>
                    </div>

                    <!-- Navigation Tabs -->
                    <div class="p-4 pb-0">
                        <ul class="nav nav-pills nav-fill mb-4" id="authTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="login-tab" data-bs-toggle="pill" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">
                                    <i class="fas fa-sign-in-alt me-2"></i>Login
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="signup-tab" data-bs-toggle="pill" data-bs-target="#signup" type="button" role="tab" aria-controls="signup" aria-selected="false">
                                    <i class="fas fa-user-plus me-2"></i>Sign Up
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content p-4 pt-0" id="authTabContent">
                        <!-- Login Tab -->
                        <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                            <div class="fade-in">
                                <div class="text-center mb-4">
                                    <h3 class="fw-bold">Welcome Back</h3>
                                    <p class="text-muted">Sign in to your account</p>
                                </div>

                                <form id="loginForm" novalidate>
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <div class="form-floating">
                                                <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" required>
                                                <label for="loginEmail"><i class="fas fa-envelope me-2"></i>Email address</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                                                <label for="loginPassword"><i class="fas fa-lock me-2"></i>Password</label>
                                                <div class="invalid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <button type="submit" class="btn btn-primary btn-auth w-100">
                                                <i class="fas fa-sign-in-alt me-2"></i>Sign In
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Signup Tab -->
                        <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
                            <div class="fade-in">
                                <div class="text-center mb-4">
                                    <h3 class="fw-bold">Create Account</h3>
                                    <p class="text-muted">Join our fashion community today</p>
                                </div>

                                <form id="signupForm" novalidate>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="form-floating">
                                                <input type="text" class="form-control" id="firstName" placeholder="John" required minlength="2" maxlength="50">
                                                <label for="firstName"><i class="fas fa-user me-2"></i>First name</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <div class="form-floating">
                                                <input type="text" class="form-control" id="lastName" placeholder="Doe" required minlength="2" maxlength="50">
                                                <label for="lastName"><i class="fas fa-user me-2"></i>Last name</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-floating">
                                                <input type="email" class="form-control" id="signupEmail" placeholder="name@example.com" required>
                                                <label for="signupEmail"><i class="fas fa-envelope me-2"></i>Email address</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="signupPassword" placeholder="Password" required minlength="8" maxlength="100">
                                                <label for="signupPassword"><i class="fas fa-lock me-2"></i>Password</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                            <div class="password-strength mt-2" id="passwordStrength"></div>
                                            <small class="text-muted">Password must be at least 8 characters with uppercase, lowercase, number, and special character</small>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <div class="form-floating">
                                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required>
                                                <label for="confirmPassword"><i class="fas fa-lock me-2"></i>Confirm password</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <div class="form-floating">
                                                <input type="tel" class="form-control" id="phoneNumber" placeholder="+1234567890" pattern="[+]?[0-9\s\-\(\)]{10,}" required>
                                                <label for="phoneNumber"><i class="fas fa-phone me-2"></i>Phone number</label>
                                                <div class="invalid-feedback"></div>
                                                <div class="valid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <div class="form-floating">
                                                <input type="date" class="form-control" id="birthDate" max="" required>
                                                <label for="birthDate"><i class="fas fa-calendar me-2"></i>Date of birth</label>
                                                <div class="invalid-feedback"></div>
                                            </div>
                                        </div>

                                        <div class="col-12 mb-3">
                                            <button type="submit" class="btn btn-primary btn-auth w-100">
                                                <i class="fas fa-user-plus me-2"></i>Create Account
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="successToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-check-circle me-2"></i>
                <strong class="me-auto">Success</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="successMessage"></div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="margin-top: 80px;">
        <div id="errorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-danger text-white">
                <i class="fas fa-exclamation-circle me-2"></i>
                <strong class="me-auto">Error</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="errorMessage"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Cookie management functions
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const cookieName = `${name}=`;
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.indexOf(cookieName) === 0) {
                    return cookie.substring(cookieName.length, cookie.length);
                }
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;
        }

        // User data storage
        let userData = JSON.parse(localStorage.getItem('userData') || '{}');
        let currentUser = null;

        // Bootstrap toast instances
        const successToast = new bootstrap.Toast(document.getElementById('successToast'));
        const errorToast = new bootstrap.Toast(document.getElementById('errorToast'));

        // Initialize date input max value
        document.getElementById('birthDate').max = new Date().toISOString().split('T')[0];

        // Check if user is first-time visitor
        function checkFirstVisit() {
            const visitedBefore = getCookie('visitedBefore');
            const userEmail = getCookie('userEmail');
            
            if (!visitedBefore) {
                // First time visitor - set cookie and show signup tab
                setCookie('visitedBefore', 'true', 365);
                document.getElementById('signup-tab').click();
                document.getElementById('welcomeBack').classList.add('d-none');
            } else if (userEmail) {
                // Returning user with email cookie - show login tab with welcome message
                document.getElementById('loginEmail').value = userEmail;
                document.getElementById('welcomeBack').classList.remove('d-none');
                document.getElementById('login-tab').click();
            } else {
                // Returning user without email cookie - show login tab
                document.getElementById('welcomeBack').classList.remove('d-none');
                document.getElementById('login-tab').click();
            }
        }

        // User data storage functions
        function storeUser(user) {
            userData[user.email] = user;
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function getUser(email) {
            return userData[email] || null;
        }

        function setCurrentUser(user) {
            currentUser = user;
            setCookie('userEmail', user.email, 30);
        }

        function getCurrentUser() {
            const email = getCookie('userEmail');
            if (email) {
                return getUser(email);
            }
            return null;
        }

        // Show toast messages
        function showToast(type, message) {
            if (type === 'success') {
                document.getElementById('successMessage').textContent = message;
                successToast.show();
            } else if (type === 'error') {
                document.getElementById('errorMessage').textContent = message;
                errorToast.show();
            }
        }

        // Field validation
        function validateField(field) {
            if (field.checkValidity()) {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
                return true;
            } else {
                field.classList.remove('is-valid');
                field.classList.add('is-invalid');
                
                // Set custom error messages
                let errorMessage = '';
                if (field.validity.valueMissing) {
                    errorMessage = 'This field is required';
                } else if (field.validity.typeMismatch) {
                    errorMessage = 'Please enter a valid email address';
                } else if (field.validity.tooShort) {
                    errorMessage = `Value should be at least ${field.minLength} characters`;
                } else if (field.validity.patternMismatch) {
                    errorMessage = 'Please enter a valid phone number';
                }
                
                field.nextElementSibling.nextElementSibling.textContent = errorMessage;
                return false;
            }
        }

        // Password strength indicator
        document.getElementById('signupPassword').addEventListener('input', function() {
            const password = this.value;
            const strengthBar = document.getElementById('passwordStrength');
            let strength = 0;
            
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            strengthBar.style.width = strength + '%';
            
            if (strength < 50) {
                strengthBar.style.backgroundColor = '#dc3545';
            } else if (strength < 100) {
                strengthBar.style.backgroundColor = '#ffc107';
            } else {
                strengthBar.style.backgroundColor = '#198754';
            }
        });

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            // Validate all fields
            let isFormValid = true;
            const fields = ['loginEmail', 'loginPassword'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!validateField(field)) {
                    isFormValid = false;
                }
            });

            if (!isFormValid) {
                showToast('error', 'Please correct the errors in the form');
                return;
            }

            // Check if user exists
            const user = getUser(email);
            if (!user) {
                showToast('error', 'No account found with this email address');
                return;
            }

            if (user.password !== password) {
                showToast('error', 'Incorrect password');
                return;
            }

            // Login successful
            setCurrentUser(user);
            showToast('success', `Welcome back, ${user.firstName}!`);
            
            setTimeout(() => {
                window.location.href = 'index.html'; // Redirect to main page
            }, 2000);
        });

        // Signup form handler
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                email: document.getElementById('signupEmail').value.trim(),
                password: document.getElementById('signupPassword').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                phoneNumber: document.getElementById('phoneNumber').value.trim(),
                birthDate: document.getElementById('birthDate').value,
            };

            // Validate all fields
            let isFormValid = true;
            const fields = ['firstName', 'lastName', 'signupEmail', 'signupPassword', 'confirmPassword'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!validateField(field)) {
                    isFormValid = false;
                }
            });

            // Validate password confirmation
            if (formData.password !== formData.confirmPassword) {
                document.getElementById('confirmPassword').classList.add('is-invalid');
                document.getElementById('confirmPassword').nextElementSibling.nextElementSibling.textContent = 'Passwords do not match';
                isFormValid = false;
            } else {
                document.getElementById('confirmPassword').classList.remove('is-invalid');
                document.getElementById('confirmPassword').classList.add('is-valid');
            }

            if (!isFormValid) {
                showToast('error', 'Please correct the errors in the form');
                return;
            }

            // Check if user already exists
            if (getUser(formData.email)) {
                showToast('error', 'An account with this email already exists');
                return;
            }

            // Create user
            const user = {
                firstName: formData.firstName,
                lastName: formData.lastName,
                email: formData.email,
                password: formData.password,
                phoneNumber: formData.phoneNumber,
                birthDate: formData.birthDate,
                newsletter: formData.newsletter,
                createdAt: new Date().toISOString()
            };

            storeUser(user);
            setCurrentUser(user);
            
            showToast('success', `Welcome, ${user.firstName}! Your account has been created.`);
            
            setTimeout(() => {
                window.location.href = 'login.html'; 
            }, 2000);
        });

        // Real-time validation for form fields
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
        });

        // Initialize page
        checkFirstVisit();
    </script>
  </body>
</html>